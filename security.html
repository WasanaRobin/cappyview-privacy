<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Security – CappyView</title>
  <style>
    body { max-width: 800px; margin: 40px auto; padding: 0 20px; font: 16px/1.6 system-ui, -apple-system, sans-serif; }
    h1 { color: #1a73e8; }
    h2 { color: #333; margin-top: 2em; }
    code { background: #f5f5f5; padding: 2px 6px; border-radius: 3px; font-size: 0.9em; }
    ul { margin: 0.5em 0; }
    li { margin: 0.5em 0; }
    .context-note { background: #f9f9f9; border-left: 3px solid #999; padding: 1em; margin: 2em 0; font-size: 0.95em; color: #666; }
  </style>
</head>
<body>
<main>
  <h1>Security Information – CappyView</h1>

  <h2>Manifest Permissions (Justification)</h2>
  <ul>
    <li><strong>storage</strong> — Save non-sensitive UI preferences such as sidebar width, toolbar state, PDF zoom, and theme color. Data is stored in <code>chrome.storage.local</code> and <code>chrome.storage.sync</code>; no sensitive information or identifiers are ever written.</li>
    <li><strong>scripting</strong> — Used only on authorized workplace pages to run small, in-page DOM probes via <code>chrome.scripting.executeScript</code>. These probes discover related links (samples, support pages, and attachment PDFs) so the "Open / Close Tabs" tools can correctly identify which tabs belong to the active case. No remote code is executed, no scripts are injected into non-authorized sites, and the results never leave the user's machine.</li>
    <li><strong>tabs</strong> — Open and manage case-related tabs (Files, Images, Samples, Support, Review & Send). Used only to read the active tab's URL for routing and open known destinations within authorized systems. Does <strong>not</strong> enumerate unrelated tabs, scrape page content, or access browser history.</li>
    <li><strong>webNavigation</strong> — Detect navigation changes (SPA route updates, reloads) to re-attach or re-hydrate toolbars and sidebars. Observes navigation events only; does <strong>not</strong> intercept or alter network traffic.</li>
    <li><strong>host_permissions</strong> — Limited to specific authorized workplace domains that users have legitimate access to through their organizational credentials. The extension cannot access any other websites or domains.</li>
  </ul>
  <p><em>No analytics, no telemetry, no background beacons.</em></p>

  <h2>Content Security</h2>
  <ul>
    <li>No inline scripts or string-built event handlers in any HTML pages.</li>
    <li>Background script is MV3-compliant and registered as a module.</li>
    <li>Dynamic DOM updates always use <code>textContent</code>, <code>innerText</code>, or DOMPurify-sanitized HTML.</li>
    <li>Shared <strong>Sanitization Utility</strong> wraps DOMPurify with strict <code>SANITIZE_OPTS</code> applied consistently across: sidebar renderers, toolbar modules, gallery, and options pages.</li>
    <li><code>safeDisplay</code> and <code>sanitizeText</code> utilities enforce plain text when possible.</li>
  </ul>

  <h2>Messaging</h2>
  <ul>
    <li>All <code>postMessage</code> listeners validate <code>event.origin</code> against trusted origins.</li>
    <li>Background verifies identifiers and <code>searchType</code> before relaying to search tabs.</li>
    <li>No use of wildcard (<code>'*'</code>) origins.</li>
    <li>Payload schemas validated (<code>type</code>, <code>origin</code>, and key structure).</li>
    <li>Background listener for <code>openBackgroundTabs</code> de-duplicates URLs and validates before opening.</li>
    <li>Messaging includes verified events for <strong>theme sync</strong>, <strong>options updates</strong>, and <strong>toolbar refresh</strong>.</li>
  </ul>

  <h2>DOM & XSS Protection</h2>
  <ul>
    <li>All direct <code>innerHTML</code> replaced with DOMPurify-sanitized insertion.</li>
    <li><code>tableFilter</code> and sidebar builders sanitize all rendered HTML fragments.</li>
    <li>No <code>eval</code>, <code>Function</code>, or dynamic string timers.</li>
    <li>Shared utilities (<code>sanitizeText</code>, <code>safeInsert</code>) enforce safe rendering paths.</li>
    <li>Strict Content Security Policy enforced by MV3 packaging.</li>
  </ul>

  <h2>Build & Release</h2>
  <ul>
    <li>No secrets, credentials, or API keys in repository.</li>
    <li>No analytics or telemetry.</li>
    <li><code>purify.min.js</code> vendored and pinned to a known version.</li>
    <li><code>LICENSE.txt</code> and <code>LICENSES/</code> included in build output.</li>
    <li>No new third-party libraries introduced in this release.</li>
    <li>Theme, customization, and options hub scripts verified for CSP compliance.</li>
  </ul>

  <h2>Third-Party Licenses</h2>
  <p>
    This extension bundles <strong>DOMPurify</strong> for safe HTML sanitization.
    DOMPurify is licensed under the Apache License 2.0. You can view the full
    license text here:
    <a href="licenses/DOMPurify-Apache-2.0.txt">DOMPurify-Apache-2.0.txt</a>.
  </p>

  <div class="context-note">
    <p><strong>Technical Context:</strong> CappyView is designed for use within authorized organizational case management and laboratory information systems. The extension requires existing workplace credentials and operates only within the scope of permissions already granted to the user by their organization. All processing occurs locally on the user's device.</p>
  </div>

  <hr style="margin: 3em 0; border: none; border-top: 1px solid #ddd;">
  
  <nav>
    <a href="index.html">About CappyView</a> |
    <a href="privacy.html">Privacy Policy</a> |
    <a href="licenses.html">Third-Party Licenses</a>
  </nav>
</main>
</body>
</html>
